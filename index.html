<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating Advantages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        /* Define Cavaliers' color palette */
        :root {
            --cavs-wine: #6F263D;
            --cavs-gold: #FFC72C;
            --cavs-black: #000000;
            --cavs-white: #FFFFFF;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--cavs-white);
            color: var(--cavs-black);
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem;
        }
        .section-header {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--cavs-wine);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .card {
            background-color: #f8f8f8; /* A very light gray to differentiate from the background */
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }
        .rank-high {
            color: green;
            font-weight: bold;
        }
        .rank-low {
            color: red;
            font-weight: bold;
        }
        .team-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.8rem;
        }
        .team-table th, .team-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        .team-table th {
            background-color: var(--cavs-wine);
            color: var(--cavs-white);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .team-table tbody tr:nth-child(even) {
            background-color: #f1f1f1;
        }
        .team-table tbody tr:hover {
            background-color: #e0e0e0;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container">
        <header class="text-center py-12">
            <h1 class="text-5xl font-bold" style="color: var(--cavs-wine);">Creating Advantages</h1>
            <p class="mt-4 text-xl text-gray-600">Visualizing how NBA players create points by generating advantages.</p>
        </header>

        <section class="mb-16">
            <div class="card">
                <h2 class="section-header">How to Quantify It</h2>
                <p class="text-lg text-center mb-8">
                    "Advantage PTS Created" is a metric that quantifies how a player's actions lead to scoring opportunities for their team. It measures the points generated from various types of advantages created on the court.
                </p>

                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mt-8">
                    <div class="p-6 bg-gray-50 rounded-lg shadow-inner" style="background-color: var(--cavs-wine); color: var(--cavs-white);">
                        <h3 class="text-xl font-semibold mb-2" style="color: var(--cavs-gold);">Self-Creation</h3>
                        <p class="text-sm">Points a player scores through their own actions, such as one-on-one moves or off-the-dribble shots, without an immediate assist. Only includes self-creation that leads to high quality shots.</p>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg shadow-inner" style="background-color: var(--cavs-wine); color: var(--cavs-white);">
                        <h3 class="text-xl font-semibold mb-2" style="color: var(--cavs-gold);">Create for Others</h3>
                        <p class="text-sm">Points generated from a player's passes that lead to a teammate's score, essentially quantifying their playmaking impact. Only includes potential assists that lead to high quality shots.</p>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg shadow-inner" style="background-color: var(--cavs-wine); color: var(--cavs-white);">
                        <h3 class="text-xl font-semibold mb-2" style="color: var(--cavs-gold);">Basket Cuts</h3>
                        <p class="text-sm">Points created when a player makes a timely cut to the basket, catching the defense off-guard for a high-percentage score.</p>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg shadow-inner" style="background-color: var(--cavs-wine); color: var(--cavs-white);">
                        <h3 class="text-xl font-semibold mb-2" style="color: var(--cavs-gold);">Movement Shooting</h3>
                        <p class="text-sm">Points from shots a player takes while moving, such as coming off screens or running in transition, leveraging their off-ball movement.</p>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg shadow-inner" style="background-color: var(--cavs-wine); color: var(--cavs-white);">
                        <h3 class="text-xl font-semibold mb-2" style="color: var(--cavs-gold);">Offensive Rebounds</h3>
                        <p class="text-sm">Points created by a player after securing an offensive rebound.</p>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg shadow-inner" style="background-color: var(--cavs-wine); color: var(--cavs-white);">
                        <h3 class="text-xl font-semibold mb-2" style="color: var(--cavs-gold);">Ball Control</h3>
                        <p class="text-sm">Points saved/lost by turnovers.</p>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg shadow-inner" style="background-color: var(--cavs-wine); color: var(--cavs-white);">
                        <h3 class="text-xl font-semibold mb-2" style="color: var(--cavs-gold);">Drawing Doubles</h3>
                        <p class="text-sm">Points generated when a player's presence attracts a second defender, leaving a teammate open for a scoring play.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-16">
            <div class="card">
                <h2 class="section-header">How Do Individual Players Create Advantages?</h2>
                <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-8">
                    <div>
                        <label for="team-select" class="text-lg font-medium mb-2">Select a Team:</label>
                        <select id="team-select" class="w-full md:w-48 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2" style="border-color: var(--cavs-wine); focus-ring-color: var(--cavs-gold);">
                            <option value="">-- All Teams --</option>
                        </select>
                    </div>
                    <div>
                        <label for="player-select" class="text-lg font-medium mb-2">Select a Player:</label>
                        <select id="player-select" class="w-full md:w-48 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2" style="border-color: var(--cavs-wine); focus-ring-color: var(--cavs-gold);">
                            <option value="">-- Choose a Player --</option>
                        </select>
                    </div>
                </div>
                <div class="h-96 md:h-[500px] w-full">
                    <canvas id="player-chart"></canvas>
                </div>
            </div>
        </section>

        <section class="mb-16">
            <div class="card">
                <h2 class="section-header">Players by Team</h2>
                <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-8">
                    <label for="team-player-select" class="text-lg font-medium">Select a Team:</label>
                    <select id="team-player-select" class="w-full md:w-48 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2" style="border-color: var(--cavs-wine); focus-ring-color: var(--cavs-gold);">
                        <option value="">-- Select a Team --</option>
                    </select>
                </div>
                <div id="player-list-container" class="mt-8">
                    <p class="text-center text-gray-500">Please select a team to see the player list.</p>
                </div>
            </div>
        </section>
        
        <section>
            <div class="card">
                <h2 class="section-header">Team Advantages Metrics & Ranks</h2>
                <div id="team-table-container" class="overflow-x-auto">
                    </div>
            </div>
        </section>

    </div>

    <script>
        let playerChart = null;
        let allPlayerData = []; // Store the full dataset
        const csvFilePath = 'Advantages Created.csv';
        const teamCsvFilePath = 'Team Advantages Created.csv';

        // Function to parse the CSV data
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = lines.slice(1).map(line => {
                const values = line.split(',').map(v => v.trim());
                const player = {};
                headers.forEach((header, i) => {
                    if (header === 'Ballhandler' || header === 'Team') {
                        player[header] = values[i];
                    } else {
                        player[header] = parseFloat(values[i]);
                    }
                });
                return player;
            });
            return data;
        }

        // Function to populate the team dropdowns
        function populateTeamDropdowns(data) {
            const teamSelect = document.getElementById('team-select');
            const teamPlayerSelect = document.getElementById('team-player-select');
            const teams = [...new Set(data.map(player => player.Team))];
            teams.sort();

            teams.forEach(team => {
                const option1 = document.createElement('option');
                option1.value = team;
                option1.textContent = team;
                teamSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = team;
                option2.textContent = team;
                teamPlayerSelect.appendChild(option2);
            });
        }

        // Function to populate the player dropdown based on team selection
        function populatePlayerDropdown(data, selectedTeam) {
            const playerSelect = document.getElementById('player-select');
            // Clear existing options except the first one
            while (playerSelect.options.length > 1) {
                playerSelect.remove(1);
            }

            const filteredPlayers = selectedTeam
                ? data.filter(player => player.Team === selectedTeam)
                : data;

            // Sort the filtered player data alphabetically by name
            filteredPlayers.sort((a, b) => {
                return a.Ballhandler.localeCompare(b.Ballhandler);
            });

            filteredPlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.Ballhandler;
                option.textContent = player.Ballhandler;
                playerSelect.appendChild(option);
            });
        }

        // Function to update the chart with player data
        function updatePlayerChart(playerData) {
            const chartCanvas = document.getElementById('player-chart');
            const metricCategories = [
                'Self-Creation', 'Create for Others',
                'Basket Cuts', 'Movement Shooting', 'OREB',
                'Ball Control', 'Drawing Doubles'
            ];
            
            if (playerChart) {
                playerChart.destroy();
            }

            const metricData = playerData ? metricCategories.map(cat => playerData[cat]) : [];
            const titleText = playerData ? `${playerData.Ballhandler}'s Advantage Points Creation` : 'Please select a player';

            playerChart = new Chart(chartCanvas, {
                type: 'bar',
                data: {
                    labels: metricCategories,
                    datasets: [{
                        label: 'Advantage Points Created',
                        data: metricData,
                        backgroundColor: [
                            '#FFC72C', // True Gold
                            '#6F263D', // Wine
                            '#FFC72C', // True Gold
                            '#6F263D', // Wine
                            '#FFC72C', // True Gold
                            '#6F263D', // Wine
                            '#FFC72C'  // True Gold
                        ],
                        borderColor: '#000000', // Black
                        borderWidth: 1,
                        borderRadius: 6,
                        barPercentage: 0.8,
                        categoryPercentage: 0.9
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Points Created',
                                color: '#000000'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: '#000000'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#000000'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false,
                        },
                        title: {
                            display: true,
                            text: titleText,
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#000000'
                        },
                        tooltip: {
                            callbacks: {
                                title: (tooltipItems) => {
                                    const category = tooltipItems[0].label;
                                    const value = tooltipItems[0].raw;
                                    return `${category}: ${value} Pts`;
                                },
                                label: () => null,
                            }
                        }
                    }
                }
            });
        }

        // New function to generate the player list HTML for a selected team
        function displayPlayersByTeam(selectedTeam) {
            const container = document.getElementById('player-list-container');
            if (!selectedTeam) {
                container.innerHTML = '<p class="text-center text-gray-500">Please select a team to see the player list.</p>';
                return;
            }

            const teamPlayers = allPlayerData.filter(p => p.Team === selectedTeam);
            
            // Get all metric categories
            const metricCategories = [
                'Self-Creation', 'Create for Others',
                'Basket Cuts', 'Movement Shooting', 'OREB',
                'Ball Control', 'Drawing Doubles'
            ];

            // Calculate team averages for each metric
            const teamAverages = {};
            metricCategories.forEach(cat => {
                const total = teamPlayers.reduce((sum, p) => sum + p[cat], 0);
                teamAverages[cat] = total / teamPlayers.length;
            });
            
            // Sort players by total 'Advantage PTS Created' in descending order
            teamPlayers.sort((a, b) => b['Advantage PTS Created'] - a['Advantage PTS Created']);

            let html = `<h3 class="text-xl font-semibold mb-4 text-center">Players for ${selectedTeam}</h3>`;
            html += `<ul class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">`;
            
            teamPlayers.forEach(player => {
                html += `<li class="p-4 bg-white rounded-lg shadow-md">
                    <p class="text-xl font-bold mb-2">${player.Ballhandler}</p>
                    <p class="text-sm text-gray-600 mb-2">Total Advantage PTS Created: <span class="font-bold text-lg">${player['Advantage PTS Created']}</span></p>
                    <ul class="text-sm space-y-1">`;
                
                metricCategories.forEach(cat => {
                    const value = player[cat];
                    const average = teamAverages[cat];
                    let rankClass = '';
                    if (value > average * 1.2) { // 20% above average
                        rankClass = 'rank-high';
                    } else if (value < average * 0.8 && value > 0) { // 20% below average
                        rankClass = 'rank-low';
                    }
                    
                    html += `<li class="flex justify-between">
                        <span>${cat}:</span>
                        <span class="${rankClass}">${value}</span>
                    </li>`;
                });
                
                html += `</ul></li>`;
            });
            
            html += `</ul>`;
            container.innerHTML = html;
        }

        // New function to generate the team data table
        function createTeamTable(teamData) {
            const container = document.getElementById('team-table-container');
            const table = document.createElement('table');
            table.className = 'team-table';

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            // Exclude 'Rk' columns from headers
            const headers = Object.keys(teamData[0]).filter(header => !header.endsWith(' Rk'));
            
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            teamData.forEach(team => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.textContent = team[header];
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            container.appendChild(table);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Fetch and process player data
            fetch(csvFilePath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(csvData => {
                    allPlayerData = parseCSV(csvData);
                    populateTeamDropdowns(allPlayerData); // Use the new function for both dropdowns
                    populatePlayerDropdown(allPlayerData, null);
                    updatePlayerChart(null);
                })
                .catch(error => console.error('Error fetching the player CSV file:', error));

            // Fetch and process team data
            fetch(teamCsvFilePath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(csvData => {
                    const teamData = parseCSV(csvData);
                    createTeamTable(teamData);
                })
                .catch(error => console.error('Error fetching the team CSV file:', error));

            const teamSelect = document.getElementById('team-select');
            teamSelect.addEventListener('change', (event) => {
                const selectedTeam = event.target.value;
                populatePlayerDropdown(allPlayerData, selectedTeam);
                document.getElementById('player-select').value = ""; // Reset player dropdown
                updatePlayerChart(null); // Clear the chart
            });

            const playerSelect = document.getElementById('player-select');
            playerSelect.addEventListener('change', (event) => {
                const selectedPlayerName = event.target.value;
                const selectedPlayer = allPlayerData.find(p => p.Ballhandler === selectedPlayerName);
                updatePlayerChart(selectedPlayer);
            });

            // New event listener for the team player list dropdown
            const teamPlayerSelect = document.getElementById('team-player-select');
            teamPlayerSelect.addEventListener('change', (event) => {
                const selectedTeam = event.target.value;
                displayPlayersByTeam(selectedTeam);
            });
        });
    </script>
</body>
</html>
